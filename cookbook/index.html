
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for labtech">
      
      
      
      
        <link rel="prev" href="../tutorial/">
      
      
        <link rel="next" href="../core/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Cookbook - labtech</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bcfcd587.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  <meta name="google-site-verification" content="vh6b0j6iPvwU3b9udYxcZrs_R0D-m6NRkRzqFnTiP-A" />
  

  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#labtech-cookbook" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="labtech" class="md-header__button md-logo" aria-label="labtech" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            labtech
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Cookbook
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ben-denham/labtech/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="labtech" class="md-nav__button md-logo" aria-label="labtech" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    labtech
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ben-denham/labtech/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    README
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Cookbook
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Cookbook
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#labtech-cookbook" class="md-nav__link">
    <span class="md-ellipsis">
      Labtech Cookbook
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Labtech Cookbook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-can-i-print-log-messages-from-my-task" class="md-nav__link">
    <span class="md-ellipsis">
      How can I print log messages from my task?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-do-i-specify-a-complex-object-like-a-model-or-dataset-as-a-task-parameter" class="md-nav__link">
    <span class="md-ellipsis">
      How do I specify a complex object, like a model or dataset, as a task parameter?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How do I specify a complex object, like a model or dataset, as a task parameter?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#constructing-objects-in-dependent-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      Constructing objects in dependent tasks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#passing-objects-in-enum-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Passing objects in Enum parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#passing-objects-in-the-lab-context" class="md-nav__link">
    <span class="md-ellipsis">
      Passing objects in the lab context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-control-multi-processing-myself-within-a-task" class="md-nav__link">
    <span class="md-ellipsis">
      How can I control multi-processing myself within a task?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-make-labtech-continue-executing-tasks-even-when-one-or-more-fail" class="md-nav__link">
    <span class="md-ellipsis">
      How can I make labtech continue executing tasks even when one or more fail?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-happens-to-my-cached-results-if-i-change-or-move-the-definition-of-a-task" class="md-nav__link">
    <span class="md-ellipsis">
      What happens to my cached results if I change or move the definition of a task?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-find-what-results-i-have-cached" class="md-nav__link">
    <span class="md-ellipsis">
      How can I find what results I have cached?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-clear-cached-results" class="md-nav__link">
    <span class="md-ellipsis">
      How can I clear cached results?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-types-of-values-should-my-tasks-return-to-be-cached" class="md-nav__link">
    <span class="md-ellipsis">
      What types of values should my tasks return to be cached?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-cache-task-results-in-a-format-other-than-pickle" class="md-nav__link">
    <span class="md-ellipsis">
      How can I cache task results in a format other than pickle?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-cache-task-results-somewhere-other-than-my-filesystem" class="md-nav__link">
    <span class="md-ellipsis">
      How can I cache task results somewhere other than my filesystem?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-lots-of-cached-results-is-slow-how-can-i-make-it-faster" class="md-nav__link">
    <span class="md-ellipsis">
      Loading lots of cached results is slow, how can I make it faster?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-see-when-a-task-was-run-and-how-long-it-took-to-execute" class="md-nav__link">
    <span class="md-ellipsis">
      How can I see when a task was run and how long it took to execute?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-access-the-results-of-intermediatedependency-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      How can I access the results of intermediate/dependency tasks?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-construct-a-multi-step-experiment-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      How can I construct a multi-step experiment pipeline?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-visualise-my-task-types-including-their-parameters-and-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      How can I visualise my task types, including their parameters and dependencies?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-use-labtech-with-mlflow" class="md-nav__link">
    <span class="md-ellipsis">
      How can I use labtech with mlflow?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-do-i-see-the-following-error-an-attempt-has-been-made-to-start-a-new-process-before-the-current-process-has-finished" class="md-nav__link">
    <span class="md-ellipsis">
      Why do I see the following error: An attempt has been made to start a new process before the current process has finished?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Labs and Tasks
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../diagram/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Diagramming
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../caching/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Caches and Storage
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#labtech-cookbook" class="md-nav__link">
    <span class="md-ellipsis">
      Labtech Cookbook
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Labtech Cookbook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-can-i-print-log-messages-from-my-task" class="md-nav__link">
    <span class="md-ellipsis">
      How can I print log messages from my task?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-do-i-specify-a-complex-object-like-a-model-or-dataset-as-a-task-parameter" class="md-nav__link">
    <span class="md-ellipsis">
      How do I specify a complex object, like a model or dataset, as a task parameter?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How do I specify a complex object, like a model or dataset, as a task parameter?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#constructing-objects-in-dependent-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      Constructing objects in dependent tasks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#passing-objects-in-enum-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Passing objects in Enum parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#passing-objects-in-the-lab-context" class="md-nav__link">
    <span class="md-ellipsis">
      Passing objects in the lab context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-control-multi-processing-myself-within-a-task" class="md-nav__link">
    <span class="md-ellipsis">
      How can I control multi-processing myself within a task?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-make-labtech-continue-executing-tasks-even-when-one-or-more-fail" class="md-nav__link">
    <span class="md-ellipsis">
      How can I make labtech continue executing tasks even when one or more fail?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-happens-to-my-cached-results-if-i-change-or-move-the-definition-of-a-task" class="md-nav__link">
    <span class="md-ellipsis">
      What happens to my cached results if I change or move the definition of a task?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-find-what-results-i-have-cached" class="md-nav__link">
    <span class="md-ellipsis">
      How can I find what results I have cached?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-clear-cached-results" class="md-nav__link">
    <span class="md-ellipsis">
      How can I clear cached results?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-types-of-values-should-my-tasks-return-to-be-cached" class="md-nav__link">
    <span class="md-ellipsis">
      What types of values should my tasks return to be cached?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-cache-task-results-in-a-format-other-than-pickle" class="md-nav__link">
    <span class="md-ellipsis">
      How can I cache task results in a format other than pickle?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-cache-task-results-somewhere-other-than-my-filesystem" class="md-nav__link">
    <span class="md-ellipsis">
      How can I cache task results somewhere other than my filesystem?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-lots-of-cached-results-is-slow-how-can-i-make-it-faster" class="md-nav__link">
    <span class="md-ellipsis">
      Loading lots of cached results is slow, how can I make it faster?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-see-when-a-task-was-run-and-how-long-it-took-to-execute" class="md-nav__link">
    <span class="md-ellipsis">
      How can I see when a task was run and how long it took to execute?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-access-the-results-of-intermediatedependency-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      How can I access the results of intermediate/dependency tasks?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-construct-a-multi-step-experiment-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      How can I construct a multi-step experiment pipeline?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-visualise-my-task-types-including-their-parameters-and-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      How can I visualise my task types, including their parameters and dependencies?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-use-labtech-with-mlflow" class="md-nav__link">
    <span class="md-ellipsis">
      How can I use labtech with mlflow?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-do-i-see-the-following-error-an-attempt-has-been-made-to-start-a-new-process-before-the-current-process-has-finished" class="md-nav__link">
    <span class="md-ellipsis">
      Why do I see the following error: An attempt has been made to start a new process before the current process has finished?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Cookbook</h1>

<h2 id="labtech-cookbook">Labtech Cookbook</h2>
<p>The following cookbook presents labtech patterns for common use cases.</p>
<p>You can also run this cookbook as an <a href="https://mybinder.org/v2/gh/ben-denham/labtech/main?filepath=examples/cookbook.ipynb">interactive notebook</a>.</p>
<div class="highlight"><pre><span></span><code>%pip install labtech fsspec mlflow pandas scikit-learn setuptools
</code></pre></div>
<div class="highlight"><pre><span></span><code>!mkdir storage
</code></pre></div>
<div class="code highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">labtech</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">clone</span><span class="p">,</span> <span class="n">ClassifierMixin</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="c1"># Prepare a dataset for examples</span>
<span class="n">digits_X</span><span class="p">,</span> <span class="n">digits_y</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_digits</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">digits_X</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">digits_X</span><span class="p">)</span>
</code></pre></div>
<h3 id="how-can-i-print-log-messages-from-my-task">How can I print log messages from my task?</h3>
<p>Using <code>labtech.logger</code> (a standard <a href="https://docs.python.org/3/library/logging.html#logger-objects">Python logger
object</a>)
is the recommended approach for logging from a task, but all output
that is sent to <code>STDOUT</code> (e.g. calls to <code>print()</code>) or <code>STDERR</code> (e.g.
uncaught exceptions) will also be captured and logged:</p>
<div class="code highlight"><pre><span></span><code><span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span>
<span class="k">class</span> <span class="nc">PrintingExperiment</span><span class="p">:</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">labtech</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Warning, the seed is: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The seed is: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span>


<span class="n">experiments</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">PrintingExperiment</span><span class="p">(</span>
        <span class="n">seed</span><span class="o">=</span><span class="n">seed</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">lab</span> <span class="o">=</span> <span class="n">labtech</span><span class="o">.</span><span class="n">Lab</span><span class="p">(</span>
    <span class="n">storage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">run_tasks</span><span class="p">(</span><span class="n">experiments</span><span class="p">)</span>
</code></pre></div>
<h3 id="how-do-i-specify-a-complex-object-like-a-model-or-dataset-as-a-task-parameter">How do I specify a complex object, like a model or dataset, as a task parameter?</h3>
<p>Because labtech needs to be able to reconstitute <code>Task</code> objects from
caches, task parameters can only be:</p>
<ul>
<li>Simple scalar types: <code>str</code>, <code>bool</code>, <code>float</code>, <code>int</code>, <code>None</code></li>
<li>Any member of an <code>Enum</code> type.</li>
<li>Task types: A task parameter is a "nested task" that will be executed
  before its parent so that it may make use of the nested result.</li>
<li>Collections of any of these types: <code>list</code>, <code>tuple</code>,
  <code>dict</code>, <a href="https://pypi.org/project/frozendict/"><code>frozendict</code></a></li>
<li>Note: Mutable <code>list</code> and <code>dict</code> collections will be converted to
    immutable <code>tuple</code> and <a href="https://pypi.org/project/frozendict/"><code>frozendict</code></a>
    collections.</li>
</ul>
<p>The are three primary patterns you can use to provide a more complex
object as a parameter to a task:</p>
<ul>
<li>Constructing the object in a dependent task</li>
<li>Passing the object in an <code>Enum</code> parameter</li>
<li>Passing the object in the lab context</li>
</ul>
<h4 id="constructing-objects-in-dependent-tasks">Constructing objects in dependent tasks</h4>
<p>If your object can be constructed from its own set of parameters, then
you can use a dependent task as a "factory" to construct your object.</p>
<p>For example, you could define a task type to construct a machine
learning model (like <code>LRClassifierTask</code> below), and then make a task
of that type a parameter for your primary experiment task:</p>
<div class="code highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>


<span class="c1"># Constructing a classifier object is inexpensive, so we don&#39;t need to</span>
<span class="c1"># cache the result</span>
<span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">LRClassifierTask</span><span class="p">:</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ClassifierMixin</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">LogisticRegression</span><span class="p">(</span>
            <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">,</span>
        <span class="p">)</span>


<span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span>
<span class="k">class</span> <span class="nc">ClassifierExperiment</span><span class="p">:</span>
    <span class="n">classifier_task</span><span class="p">:</span> <span class="n">LRClassifierTask</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="c1"># Because the classifier task result may be shared between experiments,</span>
        <span class="c1"># we clone it before fitting.</span>
        <span class="n">clf</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier_task</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>
        <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">digits_X</span><span class="p">,</span> <span class="n">digits_y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">digits_X</span><span class="p">)</span>


<span class="n">experiment</span> <span class="o">=</span> <span class="n">ClassifierExperiment</span><span class="p">(</span>
    <span class="n">classifier_task</span><span class="o">=</span><span class="n">LRClassifierTask</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">lab</span> <span class="o">=</span> <span class="n">labtech</span><span class="o">.</span><span class="n">Lab</span><span class="p">(</span>
    <span class="n">storage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">run_tasks</span><span class="p">([</span><span class="n">experiment</span><span class="p">])</span>
</code></pre></div>
<p>We can extend this example with additional task types to cater for
different types of classifiers with a
<a href="https://docs.python.org/3/library/typing.html#typing.Protocol">Protocol</a>
that defines their common result type:</p>
<div class="code highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Protocol</span>

<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>


<span class="k">class</span> <span class="nc">ClassifierTask</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ClassifierMixin</span><span class="p">:</span>
        <span class="k">pass</span>


<span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">LRClassifierTask</span><span class="p">:</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ClassifierMixin</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">LogisticRegression</span><span class="p">(</span>
            <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">,</span>
        <span class="p">)</span>


<span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">NBClassifierTask</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ClassifierMixin</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">GaussianNB</span><span class="p">()</span>


<span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span>
<span class="k">class</span> <span class="nc">ClassifierExperiment</span><span class="p">:</span>
    <span class="n">classifier_task</span><span class="p">:</span> <span class="n">ClassifierTask</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="c1"># Because the classifier task result may be shared between experiments,</span>
        <span class="c1"># we clone it before fitting.</span>
        <span class="n">clf</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier_task</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>
        <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">digits_X</span><span class="p">,</span> <span class="n">digits_y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">digits_X</span><span class="p">)</span>


<span class="n">classifier_tasks</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">LRClassifierTask</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="n">NBClassifierTask</span><span class="p">(),</span>
<span class="p">]</span>
<span class="n">experiments</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ClassifierExperiment</span><span class="p">(</span><span class="n">classifier_task</span><span class="o">=</span><span class="n">classifier_task</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">classifier_task</span> <span class="ow">in</span> <span class="n">classifier_tasks</span>
<span class="p">]</span>
<span class="n">lab</span> <span class="o">=</span> <span class="n">labtech</span><span class="o">.</span><span class="n">Lab</span><span class="p">(</span>
    <span class="n">storage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">run_tasks</span><span class="p">(</span><span class="n">experiments</span><span class="p">)</span>
</code></pre></div>
<h4 id="passing-objects-in-enum-parameters">Passing objects in <code>Enum</code> parameters</h4>
<p>For simple object parameters that have a fixed set of known values, an
<code>Enum</code> of possible values can be used to provide parameter values.</p>
<p>The following example shows how an <code>Enum</code> of functions can be used for
a parameter to specify the operation that an experiment performs:</p>
<blockquote>
<p>Note: Because parameter values will be
<a href="https://docs.python.org/3/library/pickle.html">pickled</a> when they
are copied to parallel task sub-processes, the type used in a
parameter <code>Enum</code> must support equality between identical (but
distinct) object instances.</p>
</blockquote>
<div class="code highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>


<span class="c1"># The custom class we want to provide objects of as parameters.</span>
<span class="k">class</span> <span class="nc">Dataset</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">fetch_openml</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># Support equality check to allow pickling of Enum values</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">key</span>


<span class="k">class</span> <span class="nc">DatasetOption</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">TIC_TAC_TOE</span><span class="o">=</span><span class="n">Dataset</span><span class="p">(</span><span class="s1">&#39;tic-tac-toe&#39;</span><span class="p">)</span>
    <span class="n">EEG_EYE_STATE</span><span class="o">=</span><span class="n">Dataset</span><span class="p">(</span><span class="s1">&#39;eeg-eye-state&#39;</span><span class="p">)</span>


<span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span>
<span class="k">class</span> <span class="nc">DatasetExperiment</span><span class="p">:</span>
    <span class="n">dataset</span><span class="p">:</span> <span class="n">DatasetOption</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">dataset</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>


<span class="n">experiments</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">DatasetExperiment</span><span class="p">(</span>
        <span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">DatasetOption</span>
<span class="p">]</span>
<span class="n">lab</span> <span class="o">=</span> <span class="n">labtech</span><span class="o">.</span><span class="n">Lab</span><span class="p">(</span>
    <span class="n">storage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">run_tasks</span><span class="p">(</span><span class="n">experiments</span><span class="p">)</span>
</code></pre></div>
<h4 id="passing-objects-in-the-lab-context">Passing objects in the lab context</h4>
<p>If an object cannot be conveniently defined in an <code>Enum</code> (such as
types like Numpy arrays or Pandas DataFrames that cannot be directly
specified as an <code>Enum</code> value, or large values that cannot all be
loaded into memory every time the <code>Enum</code> is loaded), then the lab
context can be used to pass the object to a task.</p>
<blockquote>
<p>Warning: Because values provided in the lab context are not cached,
they should be kept constant between runs or should not affect task
results (e.g. parallel worker counts, log levels). If changing
context values cause task results to change, then cached results may
no longer be valid.</p>
</blockquote>
<p>The following example demonstrates specifying a <code>dataset_key</code>
parameter to a task that is used to look up a dataset from the lab
context:</p>
<div class="code highlight"><pre><span></span><code><span class="n">DATASETS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;zeros&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span>
    <span class="s1">&#39;ones&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span>
<span class="p">}</span>


<span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span>
<span class="k">class</span> <span class="nc">SumExperiment</span><span class="p">:</span>
    <span class="n">dataset_key</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;DATASETS&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_key</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>


<span class="n">experiments</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">SumExperiment</span><span class="p">(</span>
        <span class="n">dataset_key</span><span class="o">=</span><span class="n">dataset_key</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">dataset_key</span> <span class="ow">in</span> <span class="n">DATASETS</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="p">]</span>
<span class="n">lab</span> <span class="o">=</span> <span class="n">labtech</span><span class="o">.</span><span class="n">Lab</span><span class="p">(</span>
    <span class="n">storage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">context</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;DATASETS&#39;</span><span class="p">:</span> <span class="n">DATASETS</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">run_tasks</span><span class="p">(</span><span class="n">experiments</span><span class="p">)</span>
</code></pre></div>
<h3 id="how-can-i-control-multi-processing-myself-within-a-task">How can I control multi-processing myself within a task?</h3>
<p>By default, Labtech executes tasks in parallel on all available CPU
cores. However, you can control multi-processing yourself by disabling
task parallelism and performing your own parallelism within a task's
<code>run()</code> method.</p>
<p>The following example uses <code>max_parallel</code> to allow only one
<code>CVExperiment</code> to be executed at a time, and then performs
cross-validation within the task using a number of workers specified
in the lab context as <code>within_task_workers</code>:</p>
<div class="code highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>


<span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">max_parallel</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CVExperiment</span><span class="p">:</span>
    <span class="n">cv_folds</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">clf</span> <span class="o">=</span> <span class="n">GaussianNB</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cross_val_score</span><span class="p">(</span>
            <span class="n">clf</span><span class="p">,</span>
            <span class="n">digits_X</span><span class="p">,</span>
            <span class="n">digits_y</span><span class="p">,</span>
            <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_folds</span><span class="p">,</span>
            <span class="n">n_jobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;within_task_workers&#39;</span><span class="p">],</span>
        <span class="p">)</span>


<span class="n">experiments</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">CVExperiment</span><span class="p">(</span>
        <span class="n">cv_folds</span><span class="o">=</span><span class="n">cv_folds</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">cv_folds</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="p">]</span>
<span class="n">lab</span> <span class="o">=</span> <span class="n">labtech</span><span class="o">.</span><span class="n">Lab</span><span class="p">(</span>
    <span class="n">storage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">context</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;within_task_workers&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">run_tasks</span><span class="p">(</span><span class="n">experiments</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>Note: Instead of limiting parallelism for a single task type by
specifying <code>max_parallel</code> in the <code>@labtech.task</code> decorator, you can
limit parallelism across all tasks with <code>max_workers</code> when
constructing a <code>labtech.Lab</code>.</p>
<p>Note: The <code>joblib</code> library used by <code>sklearn</code> does not behave
correctly when run from within a task sub-process, but setting
<code>max_parallel=1</code> or <code>max_workers=1</code> ensures tasks are run inside the
main process.</p>
</blockquote>
<h3 id="how-can-i-make-labtech-continue-executing-tasks-even-when-one-or-more-fail">How can I make labtech continue executing tasks even when one or more fail?</h3>
<p>Labtech's default behaviour is to stop executing any new tasks as soon
as any individual task fails. However, when executing tasks over a
long period of time (e.g. a large number of tasks, or even a few long
running tasks), it is sometimes helpful to have labtech continue to
execute tasks even if one or more fail.</p>
<p>If you set <code>continue_on_failure=True</code> when creating your lab,
exceptions raised during the execution of a task will be logged, but
the execution of other tasks will continue:</p>
<div class="code highlight"><pre><span></span><code><span class="n">lab</span> <span class="o">=</span> <span class="n">labtech</span><span class="o">.</span><span class="n">Lab</span><span class="p">(</span>
    <span class="n">storage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">continue_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="what-happens-to-my-cached-results-if-i-change-or-move-the-definition-of-a-task">What happens to my cached results if I change or move the definition of a task?</h3>
<p>A task's cache will store all details necessary to reinstantiate the
task object, including the qualified name of the task's class and all
of the task's parameters. Because of this, it is best not to change
the parameters and location of a task's definition once you are
seriously relying on cached results.</p>
<p>If you need to add a new parameter or behaviour to an existing task
type for which you have previously cached results, consider defining a
sub-class for that extension so that you can continue using caches for
the base class:</p>
<div class="code highlight"><pre><span></span><code><span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span>
<span class="k">class</span> <span class="nc">Experiment</span><span class="p">:</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span>


<span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span>
<span class="k">class</span> <span class="nc">ExtendedExperiment</span><span class="p">(</span><span class="n">Experiment</span><span class="p">):</span>
    <span class="n">multiplier</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">base_result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">base_result</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplier</span>
</code></pre></div>
<h3 id="how-can-i-find-what-results-i-have-cached">How can I find what results I have cached?</h3>
<p>You can use the <code>cached_task()</code> method of a <code>Lab</code> instance to retrieve
all cached task instances for a list of task types. You can then "run"
the tasks to load their cached results:</p>
<div class="code highlight"><pre><span></span><code><span class="n">cached_cvexperiment_tasks</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">cached_tasks</span><span class="p">([</span><span class="n">CVExperiment</span><span class="p">])</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">run_tasks</span><span class="p">(</span><span class="n">cached_cvexperiment_tasks</span><span class="p">)</span>
</code></pre></div>
<h3 id="how-can-i-clear-cached-results">How can I clear cached results?</h3>
<p>You can clear the cache for a list of tasks using the
<code>uncache_tasks()</code> method of a <code>Lab</code> instance:</p>
<div class="code highlight"><pre><span></span><code><span class="n">lab</span><span class="o">.</span><span class="n">uncache_tasks</span><span class="p">(</span><span class="n">cached_cvexperiment_tasks</span><span class="p">)</span>
</code></pre></div>
<p>You can also ignore all previously cached results when running a list
of tasks by passing the <code>bust_cache</code> option to <code>run_tasks()</code>:</p>
<div class="code highlight"><pre><span></span><code><span class="n">lab</span><span class="o">.</span><span class="n">run_tasks</span><span class="p">(</span><span class="n">cached_cvexperiment_tasks</span><span class="p">,</span> <span class="n">bust_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<h3 id="what-types-of-values-should-my-tasks-return-to-be-cached">What types of values should my tasks return to be cached?</h3>
<p>While you can define your task to return any Python object you like to
be cached, one generally useful approach is to return a dictionary
comprised of built-in (e.g. lists, strings, numbers) or otherwise
standard data types (e.g. arrays, dataframes). This is for two
reasons:</p>
<ol>
<li>If the returned dictionary needs to be extended to include
   additional keys, it will often be straightforward to adapt code
   that uses task results to safely continue using previously cached
   results that do not contain those keys.</li>
<li>Using custom objects (such as dataclasses) could cause
   issues when loading cached objects if the definition of the
   class ever changes.</li>
</ol>
<p>If you want to keep the typing benefits of a custom dataclass, you can
consider using a
<a href="https://docs.python.org/3/library/typing.html#typing.TypedDict"><code>TypeDict</code></a>:</p>
<div class="code highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypedDict</span><span class="p">,</span> <span class="n">NotRequired</span>


<span class="k">class</span> <span class="nc">MyTaskResult</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">predictions</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="c1"># Key added in a later version of the task. Requires Python &gt;= 3.11.</span>
    <span class="n">model_weights</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>


<span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span>
<span class="k">class</span> <span class="nc">ExampleTask</span><span class="p">:</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MyTaskResult</span><span class="p">(</span>
            <span class="n">predictions</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span>
            <span class="n">model_weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">**</span> <span class="mi">2</span><span class="p">]),</span>
        <span class="p">)</span>
</code></pre></div>
<h3 id="how-can-i-cache-task-results-in-a-format-other-than-pickle">How can I cache task results in a format other than pickle?</h3>
<p>You can define your own cache type to support storing cached results
in a format other than pickle. To do so, you must define a class that
extends <code>labtech.cache.BaseCache</code> and defines <code>KEY_PREFIX</code>,
<code>save_result()</code>, and <code>load_result()</code>. You can then configure any task
type by passing an instance of your new cache type for the <code>cache</code>
option of the <code>@labtech.task</code> decorator.</p>
<p>The following example demonstrates defining and using a custom cache
type to store Pandas DataFrames as parquet files:</p>
<div class="code highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">labtech.cache</span> <span class="kn">import</span> <span class="n">BaseCache</span>
<span class="kn">from</span> <span class="nn">labtech.types</span> <span class="kn">import</span> <span class="n">Task</span><span class="p">,</span> <span class="n">ResultT</span>
<span class="kn">from</span> <span class="nn">labtech.storage</span> <span class="kn">import</span> <span class="n">Storage</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>


<span class="k">class</span> <span class="nc">ParquetCache</span><span class="p">(</span><span class="n">BaseCache</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Caches a Pandas DataFrame result as a parquet file.&quot;&quot;&quot;</span>
    <span class="n">KEY_PREFIX</span> <span class="o">=</span> <span class="s1">&#39;parquet__&#39;</span>

    <span class="k">def</span> <span class="nf">save_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage</span><span class="p">:</span> <span class="n">Storage</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">[</span><span class="n">ResultT</span><span class="p">],</span> <span class="n">result</span><span class="p">:</span> <span class="n">ResultT</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;ParquetCache can only cache DataFrames&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">storage</span><span class="o">.</span><span class="n">file_handle</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">cache_key</span><span class="p">,</span> <span class="s1">&#39;result.parquet&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_file</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage</span><span class="p">:</span> <span class="n">Storage</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">[</span><span class="n">ResultT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">ResultT</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">storage</span><span class="o">.</span><span class="n">file_handle</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">cache_key</span><span class="p">,</span> <span class="s1">&#39;result.parquet&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_file</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>


<span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="n">ParquetCache</span><span class="p">())</span>
<span class="k">class</span> <span class="nc">TabularTask</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
            <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
        <span class="p">})</span>


<span class="n">lab</span> <span class="o">=</span> <span class="n">labtech</span><span class="o">.</span><span class="n">Lab</span><span class="p">(</span>
    <span class="n">storage</span><span class="o">=</span><span class="s1">&#39;storage/parquet_example&#39;</span><span class="p">,</span>
    <span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">lab</span><span class="o">.</span><span class="n">run_tasks</span><span class="p">([</span><span class="n">TabularTask</span><span class="p">()])</span>
</code></pre></div>
<h3 id="how-can-i-cache-task-results-somewhere-other-than-my-filesystem">How can I cache task results somewhere other than my filesystem?</h3>
<p>You can cache results in a location other than the local filesystem by
defining your own storage type that extends <code>labtech.storage.Storage</code>
and defines <code>find_keys()</code>, <code>exists()</code>, <code>file_handle()</code> and <code>delete()</code>.
You can then pass an instance of your new storage backend for the
<code>storage</code> option when constructing a <code>Lab</code> instance.</p>
<p>The following example demonstrates constructing a storage backend to
interface to the <code>LocalFileSystem</code> provided by the
<a href="https://filesystem-spec.readthedocs.io"><code>fsspec</code></a> library. This
example could be adapted for other <code>fsspec</code> implementations, such as
cloud storage providers like <a href="https://s3fs.readthedocs.io/en/latest/">Amazon S3</a>
and <a href="https://github.com/fsspec/adlfs">Azure Blob Storage</a>:</p>
<div class="code highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">labtech.storage</span> <span class="kn">import</span> <span class="n">Storage</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">IO</span><span class="p">,</span> <span class="n">Sequence</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">fsspec.implementations.local</span> <span class="kn">import</span> <span class="n">LocalFileSystem</span>


<span class="k">class</span> <span class="nc">LocalFsspecStorage</span><span class="p">(</span><span class="n">Storage</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Store results in the local file filesystem.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_dir</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">storage_dir</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fs</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">fs</span><span class="o">.</span><span class="n">mkdirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">LocalFileSystem</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_key_to_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span> <span class="o">/</span> <span class="n">key</span>

    <span class="k">def</span> <span class="nf">find_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">))</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fs</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_dir</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fs</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key_to_path</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">file_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IO</span><span class="p">:</span>
        <span class="n">fs_mode</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span> <span class="k">if</span> <span class="s1">&#39;w&#39;</span> <span class="ow">in</span> <span class="n">mode</span> <span class="k">else</span> <span class="s1">&#39;r&#39;</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fs</span><span class="p">(</span><span class="n">fs_mode</span><span class="p">)</span>
        <span class="n">key_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_to_path</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">fs</span><span class="o">.</span><span class="n">mkdirs</span><span class="p">(</span><span class="n">key_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="p">(</span><span class="n">key_path</span> <span class="o">/</span> <span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">parent</span> <span class="o">!=</span> <span class="n">key_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;Filename &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; should only reference a directory directly &quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;under the storage key directory &#39;</span><span class="si">{</span><span class="n">key_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fs</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_to_path</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">fs</span><span class="o">.</span><span class="n">rm</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span>
<span class="k">class</span> <span class="nc">Experiment</span><span class="p">:</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span>


<span class="n">experiments</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Experiment</span><span class="p">(</span>
        <span class="n">seed</span><span class="o">=</span><span class="n">seed</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">lab</span> <span class="o">=</span> <span class="n">labtech</span><span class="o">.</span><span class="n">Lab</span><span class="p">(</span>
    <span class="n">storage</span><span class="o">=</span><span class="n">LocalFsspecStorage</span><span class="p">(</span><span class="s1">&#39;storage/fsspec_example&#39;</span><span class="p">),</span>
    <span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">run_tasks</span><span class="p">(</span><span class="n">experiments</span><span class="p">)</span>
</code></pre></div>
<!--

# Simple testing of LocalFsspecStorage
storage = LocalFsspecStorage('storage/lab_example')
key = 'key1'
print(storage.exists(key))
storage.delete(key)
with storage.file_handle(key, 'example.txt', mode='w') as file:
    file.write('content')
with storage.file_handle(key, 'example.txt', mode='r') as file:
    print(file.read())
print(storage.find_keys())
print(storage.exists(key))
storage.delete(key)
print(storage.find_keys())

-->

<h3 id="loading-lots-of-cached-results-is-slow-how-can-i-make-it-faster">Loading lots of cached results is slow, how can I make it faster?</h3>
<p>If you have a large number of tasks, you may find that the overhead of
loading each individual task result from the cache is unacceptably
slow when you need to frequently reload previous results for analysis.</p>
<p>In such cases, you may find it helpful to create a final task that
depends on all of your individual tasks and aggregates all of their
results into a single cached result. Note that this final result cache
will need to be rebuilt whenever any of its dependent tasks changes or
new dependent tasks are added. Furthermore, this approach will require
additional storage for the final cache in addition to the individual
result caches.</p>
<p>The following example demonstrates defining and using an
<code>AggregationTask</code> to aggregate the results from many individual tasks
to create an aggregated cache that can be loaded more efficiently:</p>
<div class="code highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">labtech.types</span> <span class="kn">import</span> <span class="n">Task</span>

<span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span>
<span class="k">class</span> <span class="nc">Experiment</span><span class="p">:</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span>


<span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span>
<span class="k">class</span> <span class="nc">AggregationTask</span><span class="p">:</span>
    <span class="n">sub_tasks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Task</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">sub_task</span><span class="o">.</span><span class="n">result</span>
            <span class="k">for</span> <span class="n">sub_task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_tasks</span>
        <span class="p">]</span>


<span class="n">experiments</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Experiment</span><span class="p">(</span>
        <span class="n">seed</span><span class="o">=</span><span class="n">seed</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">aggregation_task</span> <span class="o">=</span> <span class="n">AggregationTask</span><span class="p">(</span>
    <span class="n">sub_tasks</span><span class="o">=</span><span class="n">experiments</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">lab</span> <span class="o">=</span> <span class="n">labtech</span><span class="o">.</span><span class="n">Lab</span><span class="p">(</span>
    <span class="n">storage</span><span class="o">=</span><span class="s1">&#39;storage/aggregation_lab&#39;</span><span class="p">,</span>
    <span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">run_task</span><span class="p">(</span><span class="n">aggregation_task</span><span class="p">)</span>
</code></pre></div>
<h3 id="how-can-i-see-when-a-task-was-run-and-how-long-it-took-to-execute">How can I see when a task was run and how long it took to execute?</h3>
<p>Once a task has been executed (or loaded from cache), you can see when
it was originally executed and how long it took to execute from the
task's <code>.result_meta</code> attribute:</p>
<div class="code highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The task was executed at: </span><span class="si">{</span><span class="n">aggregation_task</span><span class="o">.</span><span class="n">result_meta</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The task execution took: </span><span class="si">{</span><span class="n">aggregation_task</span><span class="o">.</span><span class="n">result_meta</span><span class="o">.</span><span class="n">duration</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<h3 id="how-can-i-access-the-results-of-intermediatedependency-tasks">How can I access the results of intermediate/dependency tasks?</h3>
<p>To conserve memory, labtech's default behaviour is to unload the
results of intermediate/dependency tasks once their directly dependent
tasks have finished executing.</p>
<p>A simple approach to access the results of an intermediate task may
simply be to include it's results as part of the result of the task
that depends on it - that way you only need to look at the results of
the final task(s).</p>
<p>Another approach is to include all of the intermediate tasks for which
you wish to access the results for in the call to <code>run_tasks()</code>:</p>
<div class="code highlight"><pre><span></span><code><span class="n">experiments</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Experiment</span><span class="p">(</span>
        <span class="n">seed</span><span class="o">=</span><span class="n">seed</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">aggregation_task</span> <span class="o">=</span> <span class="n">AggregationTask</span><span class="p">(</span>
    <span class="n">sub_tasks</span><span class="o">=</span><span class="n">experiments</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">lab</span> <span class="o">=</span> <span class="n">labtech</span><span class="o">.</span><span class="n">Lab</span><span class="p">(</span>
    <span class="n">storage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">run_tasks</span><span class="p">([</span>
    <span class="n">aggregation_task</span><span class="p">,</span>
    <span class="c1"># Include intermediate tasks to access their results</span>
    <span class="o">*</span><span class="n">experiments</span><span class="p">,</span>
<span class="p">])</span>
<span class="nb">print</span><span class="p">([</span>
    <span class="n">results</span><span class="p">[</span><span class="n">experiment</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">experiments</span>
<span class="p">])</span>
</code></pre></div>
<p>You can also configure labtech to not remove intermediate results from
memory by setting <code>keep_nested_results=True</code> when calling
<code>run_tasks()</code>. Intermediate results can then be accessed from the
<code>.result</code> attribute of all task objects. However, only results that
needed to be executed or loaded from cache in order to produce the
final result will be available, so you may need to set
<code>bust_cache=True</code> to ensure all intermediate tasks are executed:</p>
<div class="code highlight"><pre><span></span><code><span class="n">experiments</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Experiment</span><span class="p">(</span>
        <span class="n">seed</span><span class="o">=</span><span class="n">seed</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">aggregation_task</span> <span class="o">=</span> <span class="n">AggregationTask</span><span class="p">(</span>
    <span class="n">sub_tasks</span><span class="o">=</span><span class="n">experiments</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">lab</span> <span class="o">=</span> <span class="n">labtech</span><span class="o">.</span><span class="n">Lab</span><span class="p">(</span>
    <span class="n">storage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">run_task</span><span class="p">(</span>
    <span class="n">aggregation_task</span><span class="p">,</span>
    <span class="n">keep_nested_results</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">bust_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">([</span>
    <span class="n">experiment</span><span class="o">.</span><span class="n">result</span>
    <span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">experiments</span>
<span class="p">])</span>
</code></pre></div>
<h3 id="how-can-i-construct-a-multi-step-experiment-pipeline">How can I construct a multi-step experiment pipeline?</h3>
<p>Say you want to model a multi-step experiment pipeline, where <code>StepA</code>
is run before <code>StepB</code>, which is run before <code>StepC</code>:</p>
<div class="highlight"><pre><span></span><code>StepA -&gt; StepB -&gt; StepC
</code></pre></div>
<p>This is modeled in labtech by defining a task type for each step, and
having each step depend on the result from the previous step:</p>
<div class="code highlight"><pre><span></span><code><span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span>
<span class="k">class</span> <span class="nc">StepA</span><span class="p">:</span>
    <span class="n">seed_a</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_a</span>


<span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span>
<span class="k">class</span> <span class="nc">StepB</span><span class="p">:</span>
    <span class="n">task_a</span><span class="p">:</span> <span class="n">StepA</span>
    <span class="n">seed_b</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_a</span><span class="o">.</span><span class="n">result</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_b</span>


<span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span>
<span class="k">class</span> <span class="nc">StepC</span><span class="p">:</span>
    <span class="n">task_b</span><span class="p">:</span> <span class="n">StepB</span>
    <span class="n">seed_c</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_b</span><span class="o">.</span><span class="n">result</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_c</span>


<span class="n">task_a</span> <span class="o">=</span> <span class="n">StepA</span><span class="p">(</span>
    <span class="n">seed_a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">task_b</span> <span class="o">=</span> <span class="n">StepB</span><span class="p">(</span>
    <span class="n">seed_b</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">task_a</span><span class="o">=</span><span class="n">task_a</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">task_c</span> <span class="o">=</span> <span class="n">StepC</span><span class="p">(</span>
    <span class="n">seed_c</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">task_b</span><span class="o">=</span><span class="n">task_b</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">lab</span> <span class="o">=</span> <span class="n">labtech</span><span class="o">.</span><span class="n">Lab</span><span class="p">(</span>
    <span class="n">storage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">run_task</span><span class="p">(</span><span class="n">task_c</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div>
<h3 id="how-can-i-visualise-my-task-types-including-their-parameters-and-dependencies">How can I visualise my task types, including their parameters and dependencies?</h3>
<p><code>labtech.diagram.display_task_diagram()</code> can be used to display a
<a href="https://mermaid.js.org/syntax/classDiagram.html">Mermaid diagram</a> of
task types for a given list of tasks:</p>
<div class="code highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">labtech.diagram</span> <span class="kn">import</span> <span class="n">display_task_diagram</span>

<span class="n">display_task_diagram</span><span class="p">(</span>
    <span class="p">[</span><span class="n">task_c</span><span class="p">],</span>
    <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;RL&#39;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p><code>labtech.diagram.build_task_diagram()</code> can be similarly used to return
the Mermaid syntax for the diagram.</p>
<h3 id="how-can-i-use-labtech-with-mlflow">How can I use labtech with mlflow?</h3>
<p>If you want to log a task type as an mlflow "run", simply add
<code>mlflow_run=True</code> to the call to <code>@labtech.task()</code>, which will:</p>
<ul>
<li>Wrap each run of the task with <code>mlflow.start_run()</code></li>
<li>Tag the run with <code>labtech_task_type</code> equal to the task class name</li>
<li>Log all task parameters with <code>mlflow.log_param()</code></li>
</ul>
<p>The following example demonstrates using labtech with mlflow. Note
that you can still make any configuration changes (such as
<code>mlflow.set_experiment()</code>) before the tasks are run, and you can make
additional tracking calls (such as <code>mlflow.log_metric()</code> or
<code>mlflow.log_model()</code>) in the body of your task's <code>run()</code> method:</p>
<div class="code highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>


<span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">mlflow_run</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MLRun</span><span class="p">:</span>
    <span class="n">penalty_norm</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">clf</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">penalty</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">penalty_norm</span><span class="p">)</span>
        <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">digits_X</span><span class="p">,</span> <span class="n">digits_y</span><span class="p">)</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">digits_X</span><span class="p">)</span>

        <span class="n">train_accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">digits_y</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s1">&#39;train_accuracy&#39;</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">)</span>

        <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
            <span class="n">sk_model</span><span class="o">=</span><span class="n">clf</span><span class="p">,</span>
            <span class="n">artifact_path</span><span class="o">=</span><span class="s1">&#39;digits_model&#39;</span><span class="p">,</span>
            <span class="n">input_example</span><span class="o">=</span><span class="n">digits_X</span><span class="p">,</span>
            <span class="n">registered_model_name</span><span class="o">=</span><span class="s1">&#39;digits-model&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">labels</span>


<span class="n">runs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">MLRun</span><span class="p">(</span>
        <span class="n">penalty_norm</span><span class="o">=</span><span class="n">penalty_norm</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">penalty_norm</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;l2&#39;</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s1">&#39;example_labtech_experiment&#39;</span><span class="p">)</span>
<span class="n">lab</span> <span class="o">=</span> <span class="n">labtech</span><span class="o">.</span><span class="n">Lab</span><span class="p">(</span>
    <span class="n">storage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">run_tasks</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>Note: While the <a href="https://mlflow.org/docs/latest/getting-started/intro-quickstart/index.html#step-4-log-the-model-and-its-metadata-to-mlflow">mlflow documentation</a>
recommends wrapping only your tracking code with
<code>mlflow.start_run()</code>, labtech wraps the entire call to the <code>run()</code>
method of your task in order to track execution times in mlflow.</p>
</blockquote>
<h3 id="why-do-i-see-the-following-error-an-attempt-has-been-made-to-start-a-new-process-before-the-current-process-has-finished">Why do I see the following error: <code>An attempt has been made to start a new process before the current process has finished</code>?</h3>
<p>When running labtech in a Python script on Windows, macOS, or any
Python environment using the <code>spawn</code> multiprocessing start method, you
will see the following error if you do not guard your experiment and
lab creation and other non-definition code with <code>__name__ ==
'__main__'</code>:</p>
<div class="highlight"><pre><span></span><code>RuntimeError:
        An attempt has been made to start a new process before the
        current process has finished its bootstrapping phase.

        This probably means that you are not using fork to start your
        child processes and you have forgotten to use the proper idiom
        in the main module:

            if __name__ == &#39;__main__&#39;:
                freeze_support()
                ...

        The &quot;freeze_support()&quot; line can be omitted if the program
        is not going to be frozen to produce an executable.
</code></pre></div>
<p>To avoid this error, it is recommended that you write all of your
non-definition code for a Python script in a <code>main()</code> function, and
then guard the call to <code>main()</code> with <code>__name__ == '__main__'</code>:</p>
<div class="code highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">labtech</span>

<span class="nd">@labtech</span><span class="o">.</span><span class="n">task</span>
<span class="k">class</span> <span class="nc">Experiment</span><span class="p">:</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">experiments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Experiment</span><span class="p">(</span>
            <span class="n">seed</span><span class="o">=</span><span class="n">seed</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">lab</span> <span class="o">=</span> <span class="n">labtech</span><span class="o">.</span><span class="n">Lab</span><span class="p">(</span>
        <span class="n">storage</span><span class="o">=</span><span class="s1">&#39;storage/guarded_lab&#39;</span><span class="p">,</span>
        <span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">run_tasks</span><span class="p">(</span><span class="n">experiments</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>
<p>For details, see <a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing-safe-main-import">Safe importing of main module</a>.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tracking", "navigation.sections"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
    
  </body>
</html>